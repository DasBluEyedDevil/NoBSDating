# Firebase Setup Guide

This guide will help you set up Firebase for the NoBSDating app to enable crash reporting and analytics.

## Overview

Firebase is configured to be **optional for development** but **required for production**. The app will continue to function without Firebase configuration, but crash reporting and analytics will be disabled.

## Prerequisites

- A Google account
- Node.js and npm installed (for FlutterFire CLI)
- Flutter SDK installed
- Firebase CLI (optional but recommended)

## Step 1: Create Firebase Project

1. Go to the [Firebase Console](https://console.firebase.google.com/)
2. Click "Add project" or select an existing project
3. Enter project name: `nobsdating` (or your preferred name)
4. (Optional) Enable Google Analytics
5. Click "Create project"

## Step 2: Install FlutterFire CLI

The FlutterFire CLI helps configure Firebase for Flutter apps:

```bash
# Install FlutterFire CLI globally
dart pub global activate flutterfire_cli

# Verify installation
flutterfire --version
```

Make sure the Dart global bin directory is in your PATH:
- Windows: `%APPDATA%\Pub\Cache\bin`
- macOS/Linux: `$HOME/.pub-cache/bin`

## Step 3: Configure Firebase for Flutter

Run the FlutterFire CLI from the project root:

```bash
# Navigate to the Flutter app directory
cd frontend

# Configure Firebase (this will prompt you to select/create Firebase project)
flutterfire configure

# Select your Firebase project when prompted
# Select platforms: Android, iOS
# This will create/update firebase_options.dart
```

The CLI will:
- Create or update `lib/firebase_options.dart` with your project configuration
- Register your Android app with package name from `android/app/build.gradle`
- Register your iOS app with bundle ID from `ios/Runner.xcodeproj`
- Download configuration files to the correct locations

## Step 4: Add Android App (Manual Alternative)

If you prefer manual configuration or FlutterFire CLI fails:

1. In Firebase Console, click "Add app" > Android icon
2. Register app with package name: `com.nobsdating.app` (or your package name from `android/app/build.gradle`)
3. Download `google-services.json`
4. Place it in: `frontend/android/app/google-services.json`

### Update Android build.gradle

Ensure these are in your `android/app/build.gradle`:

```gradle
apply plugin: 'com.android.application'
apply plugin: 'com.google.gms.google-services'  // Add this line

dependencies {
    // ... other dependencies
    implementation platform('com.google.firebase:firebase-bom:32.7.0')
    implementation 'com.google.firebase:firebase-crashlytics'
    implementation 'com.google.firebase:firebase-analytics'
}
```

And in `android/build.gradle`:

```gradle
buildscript {
    dependencies {
        classpath 'com.google.gms:google-services:4.4.0'
        classpath 'com.google.firebase:firebase-crashlytics-gradle:2.9.9'
    }
}
```

## Step 5: Add iOS App (Manual Alternative)

If you prefer manual configuration:

1. In Firebase Console, click "Add app" > iOS icon
2. Register app with bundle ID: `com.nobsdating.app` (or your bundle ID from `ios/Runner.xcodeproj`)
3. Download `GoogleService-Info.plist`
4. Open Xcode: `open ios/Runner.xcworkspace`
5. Drag `GoogleService-Info.plist` into the `Runner` folder in Xcode
6. Ensure "Copy items if needed" is checked
7. Ensure the target is selected

## Step 6: Enable Crashlytics

1. In Firebase Console, go to Crashlytics
2. Click "Enable Crashlytics"
3. Follow any additional setup prompts

## Step 7: Test Firebase Integration

### Test in Development

```bash
cd frontend
flutter run
```

Check the console output for:
```
Firebase initialized successfully
Firebase Crashlytics initialized in debug mode (not sending crashes)
```

### Test Crash Reporting

Add a test crash button in your app:

```dart
import 'package:firebase_crashlytics/firebase_crashlytics.dart';

// In your test screen
ElevatedButton(
  onPressed: () {
    FirebaseCrashlytics.instance.crash(); // Force crash for testing
  },
  child: Text('Test Crash'),
)

// Or test non-fatal error
ElevatedButton(
  onPressed: () {
    try {
      throw Exception('Test exception');
    } catch (e, stack) {
      FirebaseCrashlytics.instance.recordError(e, stack);
    }
  },
  child: Text('Test Error'),
)
```

### Verify in Firebase Console

1. Force a crash using the test button
2. Wait a few minutes
3. Go to Firebase Console > Crashlytics
4. You should see the crash report

## Configuration Files

### Required Files (DO NOT commit to git)

- `frontend/android/app/google-services.json` - Android Firebase config
- `frontend/ios/Runner/GoogleService-Info.plist` - iOS Firebase config
- `frontend/lib/firebase_options.dart` - Generated by FlutterFire CLI

### Example Files (Safe to commit)

- `frontend/android/app/google-services.json.example` - Template for Android
- `frontend/ios/Runner/GoogleService-Info.plist.example` - Template for iOS

## Environment-Specific Configuration

### Development

- Firebase is optional
- Crashes are NOT sent to Firebase (debug mode)
- Console logging is enabled
- App continues without Firebase if not configured

### Production/Release

- Firebase should be configured
- Crashes ARE sent to Firebase
- Production error tracking enabled
- App still functions if Firebase initialization fails

## Troubleshooting

### "No Firebase App has been created"

This error means Firebase configuration files are missing. Either:
1. Run `flutterfire configure` to set up Firebase
2. Or continue without Firebase (app will work, but no crash reporting)

### FlutterFire CLI not found

Ensure Dart global bin is in your PATH:
```bash
# Windows (PowerShell)
$env:Path += ";$env:APPDATA\Pub\Cache\bin"

# macOS/Linux (bash/zsh)
export PATH="$PATH:$HOME/.pub-cache/bin"
```

### Build failures on Android

Ensure you have:
1. `google-services.json` in `android/app/` directory
2. Google Services plugin applied in `app/build.gradle`
3. Google Services dependency in project `build.gradle`

### Build failures on iOS

Ensure you have:
1. `GoogleService-Info.plist` added to Xcode project
2. File is in the Runner target
3. Pod dependencies updated: `cd ios && pod install`

## Security Notes

### DO NOT Commit These Files

- `google-services.json` (Android)
- `GoogleService-Info.plist` (iOS)
- `firebase_options.dart` (contains API keys)

These are already in `.gitignore`. They contain API keys and project identifiers.

### Share Configuration Securely

For team members:
1. Store files in secure password manager or internal documentation
2. Or regenerate from Firebase Console (won't affect existing apps)
3. Share via encrypted channels only

## Additional Features

### Custom User IDs

Track crashes per user:

```dart
// After user authenticates
FirebaseCrashlytics.instance.setUserIdentifier(userId);
```

### Custom Keys

Add context to crash reports:

```dart
FirebaseCrashlytics.instance.setCustomKey('subscription_tier', 'premium');
FirebaseCrashlytics.instance.setCustomKey('last_action', 'swipe_right');
```

### Log Messages

Add breadcrumbs:

```dart
FirebaseCrashlytics.instance.log('User viewed profile: $profileId');
```

## Firebase Analytics (Bonus)

Firebase Analytics is also configured. Track events:

```dart
import 'package:firebase_analytics/firebase_analytics.dart';

final analytics = FirebaseAnalytics.instance;

// Log events
await analytics.logEvent(
  name: 'profile_view',
  parameters: {'profile_id': profileId},
);

// Screen tracking
await analytics.setCurrentScreen(screenName: 'ProfileScreen');
```

## Next Steps

1. Run `flutterfire configure` in the `frontend` directory
2. Test the app to ensure Firebase initializes
3. Deploy a test build and verify crashes appear in Firebase Console
4. Set up alerts in Firebase Console for critical crashes
5. Review crash reports regularly

## Resources

- [FlutterFire Documentation](https://firebase.flutter.dev/)
- [Firebase Crashlytics](https://firebase.google.com/docs/crashlytics)
- [Firebase Console](https://console.firebase.google.com/)
- [FlutterFire CLI](https://firebase.flutter.dev/docs/cli)

## Support

For issues:
1. Check Firebase Console for project status
2. Review Crashlytics dashboard for errors
3. Check Flutter console output for initialization errors
4. Refer to FlutterFire documentation
